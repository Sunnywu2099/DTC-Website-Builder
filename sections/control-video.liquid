<style>
  video{
    display: block;
    width: 100%;
  }
  .btn-box{
        display: flex;
    justify-content: center;
    gap: 50px;
  }
  .btn-box span{
    cursor: pointer;
  }
</style>

<div class="video-control">
  <div class="video-wrapper">
    {{ section.settings.video | video_tag:class:"video-banner", autoplay: false, loop: false, muted: true, controls: false, image_size:'master' }}
  </div>
  <div class="btn-box">
    <span class="prev">prev</span>
    <span class="next">next</span>
  </div>
</div>


<script>
  let banner_video = $('.video-banner')[0]; // 获取 DOM 元素
  let prev_btn = $('.btn-box .prev');
  let next_btn = $('.btn-box .next');
  
  // 正序播放2秒
  next_btn.click(function(){
      console.log("正序播放");
      banner_video.currentTime = 0; // 从头开始播放
      banner_video.play(); // 开始播放
  
      // 在2秒后停止播放
      setTimeout(function(){
          banner_video.pause();
      }, 2000); // 2000 毫秒 = 2 秒
  });
  
  // 倒序播放2秒
  prev_btn.click(function(){
      console.log("倒序播放");
      banner_video.pause(); // 停止当前播放
  
      let duration = 2; // 倒序播放的持续时间 (秒)
      let startTime = performance.now(); // 获取当前时间
      let targetTime = banner_video.currentTime - duration; // 倒退2秒后的目标时间
  
      function reversePlay() {
          let now = performance.now(); // 当前帧的时间
          let elapsedTime = (now - startTime) / 1000; // 计算过去的时间(秒)
          banner_video.currentTime = Math.max(banner_video.currentTime - elapsedTime, 0); // 减去过去的时间，确保不小于0
          startTime = now; // 更新开始时间
  
          // 如果未达到目标时间并且 currentTime 大于 0，继续倒序播放
          if (banner_video.currentTime > targetTime && banner_video.currentTime > 0) {
              requestAnimationFrame(reversePlay); // 下一帧继续倒序播放
          } else {
              banner_video.pause(); // 停止播放
          }
      }
  
      requestAnimationFrame(reversePlay); // 开始倒序播放
  });
</script>

{% schema %}
  {
    "name": "SPX Video conntrol",
    "settings": [
      {
        "type": "video",
        "id": "video",
        "label": "A Shopify-hosted video"
      }
    ],
  "presets": [
    {
      "name": "SPX Video conntrol"
    }
  ]
    
  }
{% endschema %}